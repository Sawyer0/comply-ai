# Mapper Service Configuration

service:
  name: "mapper-service"
  version: "1.0.0"
  environment: "development"
  debug: false

server:
  host: "0.0.0.0"
  port: 8002
  workers: 1
  reload: false

# CORS Configuration - CRITICAL SECURITY SETTINGS
cors:
  # NEVER use ["*"] in production - this allows any origin to make requests
  allowed_origins:
    - "http://localhost:3000"  # Development frontend
    - "http://localhost:8080"  # Development dashboard
    - "https://app.comply-ai.com"  # Production frontend
    - "https://dashboard.comply-ai.com"  # Production dashboard
  allow_credentials: true
  allowed_methods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"
    - "OPTIONS"
  allowed_headers:
    - "Content-Type"
    - "Authorization"
    - "X-API-Key"
    - "X-Tenant-ID"
    - "X-Correlation-ID"
    - "X-Request-ID"
  max_age: 3600  # 1 hour

database:
  url: "postgresql://mapper:password@localhost:5432/mapper_db"
  pool_size: 10
  max_overflow: 20
  pool_timeout: 30
  pool_recycle: 3600

redis:
  url: "redis://localhost:6379/2"
  pool_size: 10
  socket_timeout: 5
  socket_connect_timeout: 5

storage:
  backend: "minio"  # Options: minio, s3, local
  minio_endpoint: "localhost:9000"
  minio_access_key: "minioadmin"
  minio_secret_key: "minioadmin"
  minio_secure: false
  bucket_name: "mapper-models"
  local_storage_path: "/app/storage"

security:
  api_key_header: "X-API-Key"
  jwt_secret_key: "your-secret-key-change-in-production"
  jwt_algorithm: "HS256"
  jwt_expiration_hours: 24
  rate_limit_per_minute: 30
  enable_cors: true
  cors_origins: ["*"]

monitoring:
  enable_metrics: true
  metrics_port: 9002
  enable_tracing: true
  jaeger_endpoint: "http://localhost:14268/api/traces"
  log_level: "INFO"
  structured_logging: true

ml:
  model_cache_dir: "/app/models"
  llama_model_name: "meta-llama/Llama-2-7b-chat-hf"
  lora_adapter_path: "/app/models/lora_adapters"
  vllm_gpu_memory_utilization: 0.9
  vllm_max_model_len: 4096
  vllm_tensor_parallel_size: 1
  enable_cpu_fallback: true
  inference_timeout_seconds: 30
  max_batch_size: 32

mapping:
  max_concurrent_mappings: 3
  mapping_timeout_seconds: 45
  circuit_breaker_failure_threshold: 3
  circuit_breaker_recovery_timeout: 30
  retry_attempts: 2
  retry_backoff_factor: 1.5
  confidence_threshold: 0.7

training:
  enable_training: true
  lora_rank: 16
  lora_alpha: 32
  lora_dropout: 0.1
  learning_rate: 2e-4
  batch_size: 4
  gradient_accumulation_steps: 4
  max_steps: 1000
  save_steps: 100
  eval_steps: 50

validation:
  enable_input_validation: true
  enable_output_validation: true
  max_input_length: 8192
  max_output_length: 2048
  enable_schema_validation: true

cost_monitoring:
  enable_cost_tracking: true
  cost_per_token: 0.0001
  cost_alert_threshold: 100.0
  daily_budget_limit: 1000.0

tenancy:
  enable_multi_tenancy: true
  default_tenant: "default"
  tenant_header: "X-Tenant-ID"
  tenant_isolation_level: "strict"

deployment:
  enable_canary: true
  canary_traffic_percentage: 10
  enable_ab_testing: true
  feature_flags_enabled: true